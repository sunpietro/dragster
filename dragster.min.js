/*@preserve
 * Dragster - drag'n'drop library v1.2.0
 * https://github.com/sunpietro/dragster
 *
 * Copyright 2015 Piotr Nalepa
 * http://blog.piotrnalepa.pl
 *
 * Released under the MIT license
 * https://github.com/sunpietro/dragster/blob/master/LICENSE
 *
 * Date: 2015-08-10T20:30Z
 */
(function(e,t){"use strict";e.Dragster=function(n){var r="is-dragging",o="is-drag-over",s="dragster-draggable",i="dragster-drag-region",a="dragster-drop-placeholder",l="dragster-temp",d="dragster-temp-container",c="dragster-is-hidden",f="dragster-replacable",u="touchstart",p="touchmove",m="touchend",g="mousedown",h="mousemove",v="mouseup",E="top",L="bottom",y="px",C="div",B=false,w=true,A=function(){},b={elementSelector:".dragster-block",regionSelector:".dragster-region",replaceElements:B,updateRegionsHeight:w,minimumRegionHeight:50,onBeforeDragStart:A,onAfterDragStart:A,onBeforeDragMove:A,onAfterDragMove:A,onBeforeDragEnd:A,onAfterDragEnd:A},N="draggable",D="data-placeholder-position",H={top:B,bottom:B},S={drag:{node:{}},drop:{node:{}},shadow:{node:{},top:0,left:0},placeholder:{node:{},position:""}},T,M,R,q,O,X,Y,x,I,P,k,F,j,z,G,J,K,Q,U,V,W,Z,$,_,ee;for(M in n){if(n.hasOwnProperty(M)){b[M]=n[M]}}$=function(){return Array.prototype.slice.call(t.querySelectorAll(b.elementSelector))};_=function(e){e.forEach(function(e){var t=J(),n=e.parentNode;if(n.classList.contains(s)){return B}n.insertBefore(t,e);n.removeChild(e);t.appendChild(e)})};I=$();R=Array.prototype.slice.call(t.querySelectorAll(b.regionSelector));if(b.replaceElements){Y=t.createElement(C);Y.classList.add(c);Y.classList.add(d);t.body.appendChild(Y)}q=function(e,t){var n=e.parentNode;if(!n||e.classList&&e.classList.contains(i)){return undefined}if(t(e)){return e}return t(n)?n:q(n,t)};V=function(e){var n=Array.prototype.slice.call(t.getElementsByClassName(e));n.forEach(function(e){e.parentNode.removeChild(e)})};W=function(e,n){R.forEach(function(e){e.removeEventListener(n,P.mousemove)});t.body.removeEventListener(n,P.mousemove);if(e){e.classList.remove(r)}Array.prototype.slice.call(t.getElementsByClassName(s)).forEach(function(e){if(!e.firstChild){e.parentNode.removeChild(e)}});V(a);V(l);ee()};Z=function(){Array.prototype.slice.call(t.getElementsByClassName(f)).forEach(function(e){e.classList.remove(f)})};J=function(){var e=t.createElement(C);e.setAttribute(N,w);e.classList.add(s);return e};Q=function(){var e=t.createElement(C);e.classList.add(a);return e};K=function(){var e=t.createElement(C);e.classList.add(l);e.classList.add(c);t.body.appendChild(e);return e};z=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e.nextSibling)}};G=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e)}};j=function(e){return e.classList&&e.classList.contains(i)};F=function(e){return e.classList&&e.classList.contains(s)};k=function(e){return e.classList&&e.classList.contains(a)};ee=function(){if(b.updateRegionsHeight){var n=Array.prototype.slice.call(t.getElementsByClassName(i));n.forEach(function(t){var n=Array.prototype.slice.call(t.querySelectorAll(b.elementSelector)),r=b.minimumRegionHeight;if(n.length){n.forEach(function(t){var n=e.getComputedStyle(t);r+=t.offsetHeight+parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)})}t.style.height=r+y})}};P={mousedown:function(e){e.dragster=T;if(b.onBeforeDragStart(e)===B||e.which===3){return B}e.preventDefault();var n,o=e.type===u?p:h;R.forEach(function(e){e.addEventListener(o,P.mousemove)});t.body.addEventListener(o,P.mousemove);x=q(e.target,F);if(!x){return B}n=x.getBoundingClientRect();O=K();O.innerHTML=x.innerHTML;O.style.width=n.width+y;O.style.height=n.height+y;X=O.getBoundingClientRect();x.classList.add(r);T=S;T.drag.node=x;T.shadow.node=O;e.dragster=T;b.onAfterDragStart(e)},mousemove:function(e){e.dragster=T;if(b.onBeforeDragMove(e)===B){return B}e.preventDefault();var n=e.changedTouches?e.changedTouches[0]:e,r=n.view?n.view.pageXOffset:0,o=n.view?n.view.pageYOffset:0,l=n.clientY+o,d=n.clientX+r,u=t.elementFromPoint(n.clientX,n.clientY),p=q(u,F),m=l+25,g=d-X.width/2,h=Q(),v,C;clearTimeout(U);O.style.top=m+y;O.style.left=g+y;O.classList.remove(c);T.shadow.top=m;T.shadow.left=g;if(p&&p!==x){v=p.getBoundingClientRect();C=v.height/2;Z();if(!b.replaceElements){if(l-v.top<C&&!H.top){V(a);h.setAttribute(D,E);G(p.firstChild,h);T.placeholder.position=E}else if(v.bottom-l<C&&!H.bottom){V(a);h.setAttribute(D,L);p.appendChild(h);T.placeholder.position=L}}else{p.classList.add(f)}T.placeholder.node=h;T.drop.node=p}else if(u.classList.contains(i)&&u.getElementsByClassName(s).length===0&&u.getElementsByClassName(a).length===0){u.appendChild(h);T.placeholder.position=L;T.placeholder.node=h;T.drop.node=u}else if(u.classList.contains(i)&&u.getElementsByClassName(s).length>0&&u.getElementsByClassName(a).length===0){var w=u.getElementsByClassName(s);p=w[w.length-1];h.setAttribute(D,L);V(a);p.appendChild(h);T.placeholder.position=L;T.placeholder.node=h;T.drop.node=p}else if(!u.classList.contains(i)){if(!b.replaceElements){V(a)}else{Z()}}ee();b.onAfterDragMove(e)},mouseup:function(e){e.dragster=T;if(b.onBeforeDragEnd(e)===B){return B}var n=b.replaceElements?f:a,r=t.getElementsByClassName(n)[0],s,i,l=e.type===u?p:h,c;U=setTimeout(function(){W(x,l)},200);Z();if(!x||!r){W(x,l);return B}s=q(r,F);s=s||r;if(x!==s){if(!b.replaceElements){c=J();i=r.getAttribute(D);if(i===E){G(s,c)}else{z(s,c)}if(x.firstChild){c.appendChild(x.firstChild)}}else{c=t.getElementsByClassName(d)[0];c.innerHTML=x.innerHTML;x.innerHTML=s.innerHTML;s.innerHTML=c.innerHTML;c.innerHTML=""}s.classList.remove(o)}W(x,l);b.onAfterDragEnd(e)}};_(I);t.body.addEventListener(v,P.mouseup,B);t.body.addEventListener(m,P.mouseup,B);R.forEach(function(e){e.classList.add(i);e.addEventListener(g,P.mousedown,B);e.addEventListener(v,P.mouseup,B);e.addEventListener(u,P.mousedown,B);e.addEventListener(m,P.mouseup,B)});return{update:function(){_($());ee()}}}})(window,window.document);